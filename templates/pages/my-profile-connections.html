{% extends "profile-layout.html" %}

{% load static %}

{% block extra_css %}
{% endblock extra_css %}

{% block page_content %}

<div class="card">
  <!-- Card header START -->
  <div class="card-header border-0 pb-0">
    <h5 class="card-title"> Connections</h5>
  </div>
  <!-- Card header END -->
  <!-- Card body START -->
  <div class="card-body">
    {% if pending_requests %}
    <!-- Pending Requests Section -->
    <h6 class="mb-3">Connection Requests</h6>
    {% for req in pending_requests %}
    <div class="d-md-flex align-items-center mb-4">
      <!-- Avatar -->
      <div class="avatar me-3 mb-3 mb-md-0">
        <a href="{% url 'users:profile_about' pk=req.sender.profile.pk %}">
          <img class="avatar-img rounded-circle"
            src="{% if req.sender.profile.profile_picture %}{{ req.sender.profile.profile_picture.url }}{% else %}{% static 'images/avatar/placeholder.jpg' %}{% endif %}"
            alt="">
        </a>
      </div>
      <!-- Info -->
      <div class="w-100">
        <div class="d-sm-flex align-items-start">
          <h6 class="mb-0"><a href="{% url 'users:profile_about' pk=req.sender.profile.pk %}">
              {{ req.sender.get_full_name|default:req.sender.email }}
            </a></h6>
          <p class="small ms-sm-2 mb-0">{{ req.sender.profile.job_title|default:"" }}</p>
        </div>
      </div>
      <!-- Buttons -->
      <div class="ms-md-auto d-flex gap-2">
        <form action="{% url 'users:accept_connection_request' req.pk %}" method="POST">
          {% csrf_token %}
          <button type="submit" class="btn btn-primary-soft btn-sm mb-0"> Accept </button>
        </form>
        <form action="{% url 'users:reject_connection_request' req.pk %}" method="POST">
          {% csrf_token %}
          <button type="submit" class="btn btn-danger-soft btn-sm mb-0"> Reject </button>
        </form>
      </div>
    </div>
    {% endfor %}
    <hr class="my-4">
    <h6 class="mb-3">My Connections</h6>
    {% endif %}

    {% for conn in connections %}
    <!-- Connections Item -->
    <div class="d-md-flex align-items-center mb-4">
      <!-- Avatar -->
      <div class="avatar me-3 mb-3 mb-md-0">
        <a href="{% url 'users:profile_about' pk=conn.profile.pk %}"> <img class="avatar-img rounded-circle"
            src="{% if conn.profile.profile_picture %}{{ conn.profile.profile_picture.url }}{% else %}{% static 'images/avatar/placeholder.jpg' %}{% endif %}"
            alt="">
        </a>
      </div>
      <!-- Info -->
      <div class="w-100">
        <div class="d-sm-flex align-items-start">
          <h6 class="mb-0"><a href="{% url 'users:profile_about' pk=conn.profile.pk %}">
              {{ conn.get_full_name|default:conn.email }}
            </a></h6>
          <p class="small ms-sm-2 mb-0">{{ conn.profile.job_title|default:"" }}</p>
        </div>
      </div>
      <!-- Button -->
      <div class="ms-md-auto d-flex">
        {% if request.user == profile.user %}
        <button class="btn btn-danger-soft btn-sm mb-0 me-2"> Remove </button>
        {% endif %}
        <a href="{% url 'users:message_detail' partner_pk=conn.pk %}" class="btn btn-primary-soft btn-sm mb-0">
          Message </a>
      </div>
    </div>
    {% empty %}
    <div class="text-center py-5">
      <p>No connections yet.</p>
    </div>
    {% endfor %}

    {% if connections.has_next %}
    <div class="d-grid">
      <!-- Load more button START -->
      <a href="#!" role="button" class="btn btn-sm btn-loader btn-primary-soft" data-bs-toggle="button"
        aria-pressed="true">
        <span class="load-text"> Load more connections </span>
        <div class="load-icon">
          <div class="spinner-grow spinner-grow-sm" role="status">
            <span class="visually-hidden">Loading...</span>
          </div>
        </div>
      </a>
      <!-- Load more button END -->
    </div>
    {% endif %}

  </div>
  <!-- Card body END -->
</div>

{% endblock page_content %}

{% block extra_javascript %}
{% endblock extra_javascript %}