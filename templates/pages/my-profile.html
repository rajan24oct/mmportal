{% extends "profile-layout.html" %}

{% load static %}

{% block extra_css %}
{% endblock extra_css %}

{% block page_content %}

{% include 'partials/navbar.html' %}

<div class="card card-body">
  <div class="d-flex mb-3">
    <!-- Avatar -->
    <div class="avatar avatar-xs me-2">
      <a href="#">
        <img class="avatar-img rounded-circle"
          src="{% if request.user.profile.profile_picture %}{{ request.user.profile.profile_picture.url }}{% else %}{% static 'images/avatar/placeholder.jpg' %}{% endif %}"
          alt="">
      </a>
    </div>
    <!-- Post input -->
    <form class="w-100" action="{% url 'posts:post_create' %}" method="POST" enctype="multipart/form-data">
      {% csrf_token %}
      <input class="form-control pe-4 border-0" name="content" placeholder="Share your thoughts..."
        data-bs-toggle="modal" data-bs-target="#modalCreateFeed">
    </form>
  </div>
  <!-- Share feed toolbar START -->
  <ul class="nav nav-pills nav-stack small fw-normal">
    <li class="nav-item">
      <a class="nav-link bg-light py-1 px-2 mb-0" href="#!" data-bs-toggle="modal" data-bs-target="#feedActionPhoto"> <i
          class="bi bi-image-fill text-success pe-2"></i>Photo</a>
    </li>
    <li class="nav-item">
      <a class="nav-link bg-light py-1 px-2 mb-0" href="#!" data-bs-toggle="modal" data-bs-target="#feedActionVideo"> <i
          class="bi bi-camera-reels-fill text-info pe-2"></i>Video</a>
    </li>
  </ul>
  <!-- Share feed toolbar END -->
</div>
<!-- Share feed END -->

<!-- Card feed item START -->
{% for post in posts %}
<div class="card">
  <!-- Card header START -->
  <div class="card-header border-0 pb-0">
    <div class="d-flex align-items-center justify-content-between">
      <div class="d-flex align-items-center">
        <!-- Avatar -->
        <div class="avatar avatar-story me-2">
          <a href="#!"> <img class="avatar-img rounded-circle"
              src="{% if post.author.profile.profile_picture %}{{ post.author.profile.profile_picture.url }}{% else %}{% static 'images/avatar/placeholder.jpg' %}{% endif %}"
              alt=""> </a>
        </div>
        <!-- Info -->
        <div>
          <div class="nav nav-divider">
            <h6 class="nav-item card-title mb-0"> <a href="#!"> {{ post.author.get_full_name|default:post.author.email
                }} </a></h6>
            <span class="nav-item small"> {{ post.created_at|timesince }} ago</span>
          </div>
          <p class="mb-0 small">{{ post.author.profile.job_title|default:"" }}</p>
        </div>
      </div>
    </div>
  </div>
  <!-- Card header END -->
  <!-- Card body START -->
  <div class="card-body">
    <p>{{ post.content }}</p>
    <!-- Card img -->
    {% if post.image %}
    <img class="card-img" src="{{ post.image.url }}" alt="Post">
    {% endif %}
    {% if post.video %}
    <video class="w-100 rounded" controls>
      <source src="{{ post.video.url }}" type="video/mp4">
    </video>
    {% endif %}

    <!-- Feed react START -->
    <ul class="nav nav-stack py-3 small">
      <li class="nav-item">
        <form action="{% url 'posts:like_post' post.pk %}" method="POST">
          {% csrf_token %}
          <button type="submit"
            class="nav-link border-0 bg-transparent {% if request.user in post.likes.all %}active{% endif %}">
            <i class="bi bi-hand-thumbs-up-fill pe-1"></i>Liked ({{ post.likes.count }})
          </button>
        </form>
      </li>
    </ul>
  </div>
</div>
{% empty %}
<div class="card card-body text-center py-5">
  <p>No posts yet.</p>
</div>
{% endfor %}

{% endblock page_content %}

{% block modal %}

<div class="modal fade" id="modalCreateFeed" tabindex="-1" aria-labelledby="modalLabelCreateFeed" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="modalLabelCreateFeed">Create post</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="postForm" action="{% url 'posts:post_create' %}" method="POST" enctype="multipart/form-data">
          {% csrf_token %}
          <textarea class="form-control mb-3" name="content" rows="4" placeholder="Share your thoughts..."></textarea>
          <div class="mb-3">
            <label class="form-label">Add Image (optional)</label>
            <input type="file" class="form-control" name="image" accept="image/*">
          </div>
          <div class="mb-3">
            <label class="form-label">Add Video (optional)</label>
            <input type="file" class="form-control" name="video" accept="video/*">
          </div>
        </form>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        <button type="submit" form="postForm" class="btn btn-primary">Post</button>
      </div>
    </div>
  </div>
</div>

{% endblock modal %}

{% block extra_javascript %}
{% endblock extra_javascript %}