{% extends "base.html" %}

{% load static %}

{% block extra_css %}
{% endblock extra_css %}

{% block content %}

{% include 'partials/navbar.html' %}

<main>

    <!-- Container START -->
    <div class="container">
        <div class="row g-4">

            <!-- Main content START -->
            <div class="col-lg-8 vstack gap-4">
                <!-- My profile START -->
                <div class="card">
                    <!-- Cover image -->
                    <div class="h-200px rounded-top"
                        style="background-image:url(/static/images/bg/05.jpg); background-position: center; background-size: cover; background-repeat: no-repeat;">
                    </div>
                    <!-- Card body START -->
                    <div class="card-body py-0">
                        <div class="d-sm-flex align-items-start text-center text-sm-start">
                            <div>
                                <!-- Avatar -->
                                <div class="avatar avatar-xxl mt-n5 mb-3">
                                    <img class="avatar-img rounded-circle border border-white border-3"
                                        src="{% if profile.profile_picture %}{{ profile.profile_picture.url }}{% else %}{% static 'images/avatar/placeholder.jpg' %}{% endif %}"
                                        alt="">
                                </div>
                            </div>
                            <div class="ms-sm-4 mt-sm-3">
                                <!-- Info -->
                                <h1 class="mb-0 h5">{{ profile.user.get_full_name|default:profile.user.email }} <i
                                        class="bi bi-patch-check-fill text-success small"></i>
                                </h1>
                                <p>{{ connection_count }} connections</p>
                            </div>
                            <!-- Button -->
                            <div class="d-flex mt-3 justify-content-center ms-sm-auto">
                                {% if request.user == profile.user %}
                                <a class="btn btn-danger-soft me-2" href="{% url 'users:profile_about_edit' %}"> <i
                                        class="bi bi-pencil-fill pe-1"></i> Edit
                                    profile </a>
                                {% else %}
                                {% if connection_request.status == 'accepted' %}
                                <a class="btn btn-success-soft me-2"
                                    href="{% url 'users:message_detail' partner_pk=profile.user.pk %}"> <i
                                        class="bi bi-chat-left-text-fill pe-1"></i> Message </a>
                                {% elif connection_request.status == 'pending' %}
                                <button class="btn btn-secondary me-2" disabled> Pending </button>
                                {% else %}
                                <form action="{% url 'users:send_connection_request' pk=profile.user.pk %}"
                                    method="POST">
                                    {% csrf_token %}
                                    <button type="submit" class="btn btn-primary-soft me-2"> <i
                                            class="bi bi-person-plus-fill pe-1"></i> Connect </button>
                                </form>
                                {% endif %}
                                {% endif %}
                                <div class="dropdown">
                                    <button class="icon-md btn btn-light" type="button" id="profileAction2"
                                        data-bs-toggle="dropdown" aria-expanded="false">
                                        <i class="bi bi-three-dots"></i>
                                    </button>
                                    <!-- ... rest of dropdown ... -->
                                </div>
                            </div>
                        </div>
                        <!-- List profile -->
                        <ul class="list-inline mb-0 text-center text-sm-start mt-3 mt-sm-0">
                            <li class="list-inline-item"><i class="bi bi-briefcase me-1"></i>
                                {{ profile.job_title|default:"N/A" }} </li>
                            <li class="list-inline-item"><i class="bi bi-geo-alt me-1"></i>
                                {{ profile.location|default:"N/A" }}</li>
                            <li class="list-inline-item"><i class="bi bi-calendar2-plus me-1"></i> Joined on
                                {{ profile.user.date_joining|date:"M d, Y" }}</li>
                        </ul>
                    </div>
                    <!-- Card body END -->
                    <div class="card-footer mt-3 pt-2 pb-0">
                        <!-- Nav profile pages -->
                        <ul class="nav nav-bottom-line align-items-center justify-content-center justify-content-md-start mb-0 border-0"
                            id="sidebar-account">
                            <li class="nav-item"> <a
                                    class="nav-link {% if request.GET.section == 'posts' %}active{% endif %}"
                                    href="{% url 'users:profile_about' pk=profile.pk %}?section=posts"> Posts </a> </li>
                            <li class="nav-item"> <a
                                    class="nav-link {% if not request.GET.section or request.GET.section == 'about' %}active{% endif %}"
                                    href="{% url 'users:profile_about' pk=profile.pk %}?section=about"> About </a>
                            </li>
                            <li class="nav-item"> <a
                                    class="nav-link {% if request.GET.section == 'connections' %}active{% endif %}"
                                    href="{% url 'users:profile_about' pk=profile.pk %}?section=connections">
                                    Connections <span class="badge bg-success bg-opacity-10 text-success small">
                                        {{ connection_count }}</span> </a> </li>
                            <li class="nav-item"> <a
                                    class="nav-link {% if request.GET.section == 'media' %}active{% endif %}"
                                    href="{% url 'users:profile_about' pk=profile.pk %}?section=media"> Media</a>
                            </li>
                            <li class="nav-item"> <a
                                    class="nav-link {% if request.GET.section == 'videos' %}active{% endif %}"
                                    href="{% url 'users:profile_about' pk=profile.pk %}?section=videos"> Videos</a>
                            </li>
                        </ul>
                    </div>
                </div>
                <!-- My profile END -->

                {% block page_content %}{% endblock page_content %}

            </div>
            <!-- Main content END -->

            <!-- Right sidebar START -->
            <div class="col-lg-4">

                <div class="row g-4">

                    <!-- Card START -->
                    <div class="col-md-6 col-lg-12">
                        <div class="card">
                            <div class="card-header border-0 pb-0">
                                <h5 class="card-title">About</h5>
                                <!-- Button modal -->
                            </div>
                            <!-- Card body START -->
                            <div class="card-body position-relative pt-0">
                                <p>{{ profile.about|truncatechars:100 }}</p>
                                <!-- Date time -->
                                <ul class="list-unstyled mt-3 mb-0">
                                    <li class="mb-2"> <i class="bi bi-briefcase fa-fw pe-1"></i> Designation: <strong>
                                            {{ profile.job_title|default:"N/A" }}
                                        </strong> </li>
                                    <li class="mb-2"> <i class="bi bi-heart fa-fw pe-1"></i> Status: <strong>
                                            {{ profile.get_marital_status_display|default:"N/A" }}
                                        </strong> </li>
                                    <li> <i class="bi bi-envelope fa-fw pe-1"></i> Email: <strong>
                                            {{ profile.user.email }}
                                        </strong> </li>
                                </ul>
                            </div>
                            <!-- Card body END -->
                        </div>
                    </div>
                    <!-- Card END -->

                    <!-- Card START -->
                    <div class="col-md-6 col-lg-12">
                        <div class="card">
                            <!-- Card header START -->
                            <div class="card-header d-flex justify-content-between border-0">
                                <h5 class="card-title">Experience</h5>
                                <a class="btn btn-primary-soft btn-sm" href="#!"> <i class="fa-solid fa-plus"></i> </a>
                            </div>
                            <!-- Card header END -->
                            <!-- Card body START -->
                            <div class="card-body position-relative pt-0">
                                <!-- Experience item START -->
                                <div class="d-flex">
                                    <!-- Avatar -->
                                    <div class="avatar me-3">
                                        <a href="#!"> <img class="avatar-img rounded-circle"
                                                src="{% static 'images/logo/08.svg' %}" alt=""> </a>
                                    </div>
                                    <!-- Info -->
                                    <div>
                                        <h6 class="card-title mb-0"><a href="#!"> Apple Computer, Inc. </a></h6>
                                        <p class="small">May 2015 – Present Employment Duration 8 mos <a
                                                class="btn btn-primary-soft btn-xs ms-2" href="#!">Edit </a></p>
                                    </div>
                                </div>
                                <!-- Experience item END -->

                                <!-- Experience item START -->
                                <div class="d-flex">
                                    <!-- Avatar -->
                                    <div class="avatar me-3">
                                        <a href="#!"> <img class="avatar-img rounded-circle"
                                                src="{% static 'images/logo/09.svg' %}" alt=""> </a>
                                    </div>
                                    <!-- Info -->
                                    <div>
                                        <h6 class="card-title mb-0"><a href="#!"> Microsoft Corporation </a></h6>
                                        <p class="small">May 2017 – Present Employment Duration 1 yrs 5 mos <a
                                                class="btn btn-primary-soft btn-xs ms-2" href="#!">Edit </a></p>
                                    </div>
                                </div>
                                <!-- Experience item END -->

                                <!-- Experience item START -->
                                <div class="d-flex">
                                    <!-- Avatar -->
                                    <div class="avatar me-3">
                                        <a href="#!"> <img class="avatar-img rounded-circle"
                                                src="{% static 'images/logo/10.svg' %}" alt=""> </a>
                                    </div>
                                    <!-- Info -->
                                    <div>
                                        <h6 class="card-title mb-0"><a href="#!"> Tata Consultancy Services. </a></h6>
                                        <p class="small mb-0">May 2022 – Present Employment Duration 6 yrs 10 mos <a
                                                class="btn btn-primary-soft btn-xs ms-2" href="#!">Edit </a></p>
                                    </div>
                                </div>
                                <!-- Experience item END -->

                            </div>
                            <!-- Card body END -->
                        </div>
                    </div>
                    <!-- Card END -->

                    <!-- Card START -->
                    <div class="col-md-6 col-lg-12">
                        <div class="card">
                            <!-- Card header START -->
                            <div class="card-header d-sm-flex justify-content-between border-0">
                                <h5 class="card-title">Photos</h5>
                                <a class="btn btn-primary-soft btn-sm" href="#!"> See all photo</a>
                            </div>
                            <!-- Card header END -->
                            <!-- Card body START -->
                            <div class="card-body position-relative pt-0">
                                <div class="row g-2">
                                    {% for post in media|slice:":5" %}
                                    <div class="col-{% if forloop.counter <= 2 %}6{% else %}4{% endif %}">
                                        <a href="{{ post.image.url }}" data-gallery="image-popup" data-glightbox="">
                                            <img class="rounded img-fluid" src="{{ post.image.url }}" alt="">
                                        </a>
                                    </div>
                                    {% empty %}
                                    <p class="small text-center">No photos yet.</p>
                                    {% endfor %}
                                </div>
                            </div>
                            <!-- Card body END -->
                        </div>
                    </div>
                    <!-- Card END -->

                    <!-- Card START -->
                    <div class="col-md-6 col-lg-12">
                        <div class="card">
                            <!-- Card header START -->
                            <div class="card-header d-sm-flex justify-content-between align-items-center border-0">
                                <h5 class="card-title">Friends <span
                                        class="badge bg-danger bg-opacity-10 text-danger">230</span></h5>
                                <a class="btn btn-primary-soft btn-sm" href="#!"> See all friends</a>
                            </div>
                            <!-- Card header END -->
                            <!-- Card body START -->
                            <div class="card-body position-relative pt-0">
                                <div class="row g-3">
                                    {% for conn in connections|slice:":4" %}
                                    <div class="col-6">
                                        <!-- Friends item START -->
                                        <div class="card shadow-none text-center h-100">
                                            <!-- Card body -->
                                            <div class="card-body p-2 pb-0">
                                                <div class="avatar avatar-story avatar-xl">
                                                    <a href="{% url 'users:profile_about' pk=profile.pk %}"><img
                                                            class="avatar-img rounded-circle"
                                                            src="{% if profile.profile_picture %}{{ profile.profile_picture.url }}{% else %}{% static 'images/avatar/placeholder.jpg' %}{% endif %}"
                                                            alt=""></a>
                                                </div>
                                                <h6 class="card-title mb-1 mt-3"> <a
                                                        href="{% url 'users:profile_about' pk=profile.pk %}"> {{
                                                        profile.get_full_name|default:profile.email }} </a></h6>
                                            </div>
                                            <!-- Card footer -->
                                            <div class="card-footer p-2 border-0">
                                                <a href="{% url 'users:message_detail' partner_pk=profile.user.pk %}"
                                                    class="btn btn-sm btn-primary" data-bs-toggle="tooltip"
                                                    data-bs-placement="top" title="Send message"> <i
                                                        class="bi bi-chat-left-text"></i> </a>
                                            </div>
                                        </div>
                                        <!-- Friends item END -->
                                    </div>
                                    {% empty %}
                                    <p class="small text-center">No connections yet.</p>
                                    {% endfor %}
                                </div>
                            </div>
                            <!-- Card body END -->
                        </div>
                    </div>
                    <!-- Card END -->
                </div>

            </div>
            <!-- Right sidebar END -->

        </div> <!-- Row END -->
    </div>
    <!-- Container END -->

</main>
<!-- **************** MAIN CONTENT END **************** -->

{% block modal %}{% endblock modal %}

{% endblock content %}

{% block extra_javascript %}
{% endblock extra_javascript %}